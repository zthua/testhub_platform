# 数据工厂功能说明

## 概述

数据工厂是TestHub测试平台中的智能数据生成工具箱,为测试提供高质量的测试数据生成和管理。目前提供60个实用工具,涵盖字符处理、编码转换、随机数据生成、加密解密、测试数据生成、JSON处理和Crontab表达式管理等多个场景。

## 功能特性

### 1. 字符工具（9个）
- **去除空格换行**: 去除字符串中的空格和换行符
- **字符串替换**: 替换字符串中的内容,支持正则表达式
- **字符串转义**: 将字符串进行转义处理(JSON/HTML/URL/XML)
- **字符串反转义**: 将转义字符串还原
- **字数统计**: 统计字符串的字数和字符数(中英文、数字、标点、行数、段落数)
- **文本对比**: 对比两段文本的差异
- **正则测试**: 测试正则表达式的匹配结果
- **大小写转换**: 转换字符串的大小写
- **字符串格式化**: 对字符串进行格式化处理

### 2. 编码工具（12个）
- **生成条形码**: 生成各种格式的条形码(Code128/EAN13/UPC等)
- **生成二维码**: 生成二维码
- **时间戳转换**: 时间戳与日期时间相互转换
- **进制转换**: 不同进制之间的转换(2/8/10/16进制)
- **Unicode转换**: 中文与Unicode相互转换
- **ASCII转换**: 字符与ASCII码相互转换
- **颜色值转换**: 不同颜色格式之间的转换(Hex/RGB/HSL等)
- **Base64编解码**: Base64编码和解码
- **URL编解码**: URL编码和解码
- **JWT解码**: 解码JWT令牌
- **图片转Base64**: 将图片转换为Base64编码
- **Base64转图片**: 将Base64编码转换为图片

### 3. 随机工具（10个）
- **随机整数**: 生成指定范围的随机整数
- **随机浮点数**: 生成指定范围的随机浮点数
- **随机字符串**: 生成指定长度的随机字符串
- **随机UUID**: 生成随机UUID(GUID)
- **随机布尔值**: 生成随机布尔值
- **随机MAC地址**: 生成随机MAC地址
- **随机IP地址**: 生成随机IP地址(IPv4/IPv6)
- **随机日期**: 生成指定范围内的随机日期
- **随机密码**: 生成随机密码(包含大小写、数字、特殊字符)
- **随机颜色**: 生成随机颜色数据
- **随机序列数据**: 从序列中随机选择元素

### 4. 加密工具（9个）
- **MD5加密**: 生成MD5哈希值
- **SHA1加密**: 生成SHA1哈希值
- **SHA256加密**: 生成SHA256哈希值
- **SHA512加密**: 生成SHA512哈希值
- **哈希值比对**: 比对两个哈希值是否相同
- **AES加密**: 使用AES算法加密数据
- **AES解密**: 使用AES算法解密数据
- **密码强度分析**: 分析密码的强度
- **生成随机盐值**: 生成随机盐值数据

### 5. 测试数据生成（11个）
- **生成中文姓名**: 生成随机中文姓名
- **生成手机号**: 生成随机中国手机号
- **生成邮箱**: 生成随机邮箱地址
- **生成地址**: 生成随机中文地址
- **生成身份证号**: 生成随机身份证号
- **生成公司名称**: 生成随机公司名称
- **生成银行卡号**: 生成随机银行卡号
- **生成香港身份证号**: 生成香港身份证号
- **生成营业执照号**: 生成营业执照号
- **生成用户档案**: 生成完整用户档案
- **生成经纬度**: 生成随机经纬度数据

### 6. JSON工具（10个）
- **JSON格式化**: 格式化JSON数据(支持缩进、排序键、树形展示)
- **JSON压缩**: 压缩JSON数据
- **JSON校验**: 验证JSON格式的正确性
- **JSONPath查询**: 使用JSONPath表达式查询JSON数据
- **JSON对比**: 对比两个JSON数据的差异
- **JSON扁平化**: 将嵌套JSON扁平化
- **JSON路径列表**: 列出JSON的所有路径
- **JSON转XML**: 将JSON转换为XML格式
- **JSON转YAML**: 将JSON转换为YAML格式
- **YAML转JSON**: 将YAML转换为JSON格式
- **XML转JSON**: 将XML转换为JSON格式

### 7. Crontab工具（4个）
- **生成Crontab表达式**: 生成Crontab定时任务表达式
- **解析Crontab表达式**: 解析Crontab表达式并显示执行时间
- **获取下次执行时间**: 获取Crontab表达式的下次执行时间
- **验证Crontab表达式**: 验证Crontab表达式的正确性

## 使用方式

### 1. 工具箱形式
- 按工具分类查看所有工具（7大类）
- 按使用场景查看工具（4种场景）
- 点击工具卡片即可使用
- 支持参数配置和结果查看
- 支持添加标签保存数据

### 2. 深度集成

#### HTTP API接口
```bash
POST /api/data-factory/
Content-Type: application/json

{
  "tool_name": "random_int",
  "tool_category": "random",
  "tool_scenario": "data_generate",
  "input_data": {
    "min_val": 100,
    "max_val": 999
  },
  "is_saved": true,
  "tags": ["测试", "随机数"]
}
```

#### 环境变量占位符

**接口测试和UI自动化测试都支持动态函数占位符语法：**

##### 随机数函数
```javascript
${random_int(1000, 9999)}        // 生成随机整数
${random_float(0, 100, 2)}       // 生成随机浮点数
${random_digits(6)}              // 生成随机数字字符串
```

##### 随机字符串函数
```javascript
${random_string(8)}              // 生成随机字母数字字符串
${random_letters(8)}             // 生成随机字母字符串
${random_chinese(2)}             // 生成随机中文字符
```

##### 业务数据函数
```javascript
${random_phone()}                // 生成随机手机号
${random_email()}                // 生成随机邮箱
${random_id_card()}              // 生成随机身份证号
${random_name()}                 // 生成随机中文姓名
${random_company()}              // 生成随机公司名称
${random_address()}              // 生成随机地址
${random_bank_card()}            // 生成随机银行卡号
${random_hk_id_card()}           // 生成香港身份证号
${random_business_license()}     // 生成营业执照号
${random_coordinates()}          // 生成经纬度
```

##### 时间日期函数
```javascript
${timestamp()}                  // 生成当前时间戳（毫秒）
${timestamp_sec()}              // 生成当前时间戳（秒）
${datetime()}                   // 生成当前日期时间
${date()}                      // 生成当前日期
${time()}                      // 生成当前时间
${date_offset(1)}              // 生成偏移后的日期时间
```

##### 加密和标识符函数
```javascript
${uuid()}                      // 生成UUID
${guid()}                      // 生成GUID
${base64(test123)}             // Base64编码
${md5(test123)}                // MD5加密
${sha1(test123)}               // SHA1加密
${sha256(test123)}             // SHA256加密
${random_mac()}                // 生成MAC地址
${random_ip()}                 // 生成IP地址
${random_password(16)}         // 生成随机密码
${random_color()}              // 生成随机颜色
```

##### 接口测试中的使用示例

**URL中使用：**
```
https://api.example.com/users/${random_int(1000, 9999)}
```

**请求头中使用：**
```
X-Request-ID: ${uuid()}
X-Timestamp: ${timestamp()}
```

**请求参数中使用：**
```
username: user_${random_string(6)}
email: ${random_email()}
phone: ${random_phone()}
```

**请求体（JSON）中使用：**
```json
{
  "username": "user_${random_string(8)}",
  "email": "${random_email()}",
  "phone": "${random_phone()}",
  "name": "${random_name()}",
  "password": "${random_password(16)}",
  "timestamp": "${timestamp()}"
}
```

**变量解析顺序：**
1. 先解析动态函数占位符（如 `${random_int(1000, 9999)}`）
2. 再替换环境变量（如 `{{base_url}}`）

这样可以确保动态函数生成的值也可以被环境变量引用。

### 3. 数据管理
- 保存生成结果到数据库
- 查看历史使用记录
- 按分类和场景统计
- 删除不需要的记录
- 批量生成数据
- 数据预览（支持长数据滚动查看）
- 标签管理和筛选

## 技术架构

### 后端
- Django REST Framework
- 模块化设计,易于扩展
- 支持60种工具类型
- 数据持久化和历史记录
- 标签系统

### 前端
- Vue 3 + Element Plus
- 响应式设计
- 工具箱形式展示
- 两种分类视图(按分类/按场景)
- 树形展示（JSON格式化）
- 数据预览弹窗

### 集成方式
- HTTP API接口
- 环境变量占位符
- 变量助手（UI测试）

## 使用场景

1. **测试数据生成**: 为API测试、UI自动化测试生成测试数据
2. **格式转换**: 在测试过程中转换数据格式
3. **数据验证**: 验证测试数据的正确性
4. **加密解密**: 处理敏感数据的加密和解密
5. **JSON处理**: JSON格式化、校验、对比、转换
6. **Crontab管理**: 生成、解析、验证Crontab表达式

## 扩展开发

### 添加新工具
1. 在`apps/data_factory/tools/`下创建新的工具类
2. 在`tool_list.py`中添加工具信息
3. 在`views.py`中注册工具函数
4. 前端配置工具参数

### 自定义数据生成规则
修改`test_data_tools.py`中的常量和方法,自定义生成规则。

## 依赖说明

### Python依赖
- python-barcode (条形码生成)
- qrcode (二维码生成)
- pycryptodome (AES加密)
- jsonpath_ng (JSONPath查询)
- croniter (Crontab表达式解析)

安装方法:
```bash
pip install python-barcode qrcode pycryptodome jsonpath_ng croniter
# 或
pip install -r requirements.txt
```

**数据工厂数据库表**:
- `data_factory_record`: 工具使用记录表
  - `tool_name`: 工具名称
  - `tool_category`: 工具分类（字符工具、编码工具、随机工具、加密工具、测试数据、JSON工具、Crontab工具）
  - `tool_scenario`: 使用场景（数据生成、格式转换、数据验证、加密解密）
  - `input_data`: 输入数据（JSON 格式）
  - `output_data`: 输出数据（JSON 格式）
  - `is_saved`: 是否保存
  - `tags`: 标签（JSON 格式）
  - `created_at`: 创建时间
  - `updated_at`: 更新时间
  - `user_id`: 用户 ID（外键）

**数据工厂 API 端点**:
- `GET /api/data-factory/categories/`: 获取工具分类和工具列表
- `POST /api/data-factory/`: 执行工具并保存结果
- `GET /api/data-factory/records/`: 获取使用记录
- `DELETE /api/data-factory/records/{id}/`: 删除记录
- `GET /api/data-factory/statistics/`: 获取统计信息
- `GET /api/data-factory/tags/`: 获取标签列表
- `POST /api/data-factory/batch-delete/`: 批量删除记录

## 注意事项

1. 生成的数据仅用于测试,不能用于生产环境
2. 身份证号、银行卡号等数据为随机生成,符合校验规则但不是真实数据
3. 条形码和二维码生成需要安装对应的Python依赖
4. AES加密需要安装pycryptodome模块
5. JSONPath查询需要安装jsonpath_ng库
6. Crontab表达式解析需要安装croniter库

## 开发计划

- [x] 添加更多测试数据类型（已完成）
- [x] 支持JSON工具（已完成）
- [x] 支持Crontab工具（已完成）
- [x] 支持数据预览滚动（已完成）
- [x] 支持UI测试变量助手（已完成）
- [ ] 支持自定义数据生成规则
- [ ] 支持数据导出功能
- [ ] 添加数据模板功能
- [ ] 支持批量导入数据

## 更新日志

### v1.3.0 (2026-01-26)
- 🐛 修复 JSONPath 解析问题，支持 `..` 操作符（如 `$..args`）
- ✨ 扩展代码生成语言选项，支持 30+ 种编程语言
- ✨ 实现完整的 curl 命令导入功能，支持所有 255 个 curl 参数
- 🐛 修复 cURL 命令导出格式问题
- 🔧 改进代码生成器，使用 curlconverter 库提高准确性
- 🔧 改进 curl 命令解析，正确处理 HAR 格式的 queryString、headers、cookies、postData
- 🐛 解决 npm 依赖冲突，修复 Sass 弃用警告和 WebAssembly 加载错误
- 📝 完善文档说明

### v1.2.0 (2026-01-22)
- ✨ 新增测试数据工具：生成身份证号、生成公司名称、生成银行卡号、生成香港身份证号、生成营业执照号、生成用户档案、生成经纬度
- ✨ 新增JSON工具：JSON扁平化、JSON路径列表、YAML转JSON、XML转JSON
- ✨ 新增随机工具：生成随机MAC地址、生成随机IP地址、生成随机日期、生成随机密码、生成随机颜色、生成随机序列数据
- ✨ 新增加密工具：哈希值比对、密码强度分析、生成随机盐值
- 🐛 修复数据预览弹窗样式，支持左右滚动查看长数据
- 🐛 修复UI测试变量助手，添加所有缺失的函数（60个工具全部支持）
- 🐛 调整分类统计顺序，与场景统计保持一致
- 📝 完善文档说明

### v1.1.0 (2026-01-20)
- ✨ 初始版本发布
- 提供50个实用工具
- 支持标签系统
- 支持历史记录管理
- 支持与接口测试和UI测试集成

## 反馈与支持

如有问题或建议,请联系开发团队或提交Issue。
